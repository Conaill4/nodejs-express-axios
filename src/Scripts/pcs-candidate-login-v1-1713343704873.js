!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue"),require("../../../../common/v1/src")):"function"==typeof def&&def.amd?def("pcs-candidate-login-v1",["vue","../../../../common/v1/src"],t):((e=e||self).phw=e.phw||{},e.phw.PcsCandidateLoginV1=t(e.Vue,e.PcsCommon))}(this,function(h,r){"use strict";h=h&&h.hasOwnProperty("default")?h.default:h,r=r&&r.hasOwnProperty("default")?r.default:r;var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function e(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;0<=r;r--)(s=e[r])&&(a=(n<3?s(a):3<n?s(t,i,a):s(t,i))||a);return 3<n&&a&&Object.defineProperty(t,i,a),a}var u="undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys;function g(i,o,s){(s?Reflect.getOwnMetadataKeys(o,s):Reflect.getOwnMetadataKeys(o)).forEach(function(e){var t=s?Reflect.getOwnMetadata(e,o,s):Reflect.getOwnMetadata(e,o);s?Reflect.defineMetadata(e,t,i,s):Reflect.defineMetadata(e,t,i)})}var f={__proto__:[]}instanceof Array;function a(s){return function(e,t,i){var o="function"==typeof e?e:e.constructor;o.__decorators__||(o.__decorators__=[]),"number"!=typeof i&&(i=void 0),o.__decorators__.push(function(e){return s(e,t,i)})}}function m(e){"undefined"!=typeof console&&console.warn("[vue-class-component] "+e)}var v=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function o(e,o){void 0===o&&(o={}),o.name=o.name||e._componentTag||e.name;var s=e.prototype;Object.getOwnPropertyNames(s).forEach(function(t){if("constructor"!==t)if(-1<v.indexOf(t))o[t]=s[t];else{var i=Object.getOwnPropertyDescriptor(s,t);void 0!==i.value?"function"==typeof i.value?(o.methods||(o.methods={}))[t]=i.value:(o.mixins||(o.mixins=[])).push({data:function(){var e;return(e={})[t]=i.value,e}}):(i.get||i.set)&&((o.computed||(o.computed={}))[t]={get:i.get,set:i.set})}}),(o.mixins||(o.mixins=[])).push({data:function(){return function(o,e){var t=e.prototype._init;e.prototype._init=function(){var e=this,t=Object.getOwnPropertyNames(o);if(o.$options.props)for(var i in o.$options.props)o.hasOwnProperty(i)||t.push(i);t.forEach(function(t){"_"!==t.charAt(0)&&Object.defineProperty(e,t,{get:function(){return o[t]},set:function(e){o[t]=e},configurable:!0})})};var i=new e;e.prototype._init=t;var s={};return Object.keys(i).forEach(function(e){void 0!==i[e]&&(s[e]=i[e])}),!(e.prototype instanceof h)&&0<Object.keys(s).length&&m("Component class must inherit Vue or its descendant class when class property is used."),s}(this,e)}});var t=e.__decorators__;t&&(t.forEach(function(e){return e(o)}),delete e.__decorators__);var a,r,d,i,n,l=Object.getPrototypeOf(e.prototype),c=l instanceof h?l.constructor:h,p=c.extend(o);return a=p,r=e,d=c,Object.getOwnPropertyNames(r).forEach(function(e){if(!E[e]){var t=Object.getOwnPropertyDescriptor(a,e);if(!t||t.configurable){var i,o,s=Object.getOwnPropertyDescriptor(r,e);if(!f){if("cid"===e)return;var n=Object.getOwnPropertyDescriptor(d,e);if(i=s.value,o=typeof i,null!=i&&("object"==o||"function"==o)&&n&&n.value===s.value)return}0<=y.indexOf(e)&&m("Static property name '"+e+"' declared on class '"+r.name+"' conflicts with reserved property name of Vue internal. It may cause unexpected behavior of the component. Consider renaming the property."),Object.defineProperty(a,e,s)}}}),u&&(g(i=p,n=e),Object.getOwnPropertyNames(n.prototype).forEach(function(e){g(i.prototype,n.prototype,e)}),Object.getOwnPropertyNames(n).forEach(function(e){g(i,n,e)})),p}var y=["cid","super","options","superOptions","extendOptions","sealedOptions","component","directive","filter"],E={prototype:!0,arguments:!0,callee:!0,caller:!0};function t(t){return"function"==typeof t?o(t):function(e){return o(e,t)}}t.registerHooks=function(e){v.push.apply(v,e)};var d="undefined"!=typeof Reflect&&void 0!==Reflect.getMetadata;function s(n){return void 0===n&&(n={}),function(e,t){var i,o,s;i=n,o=e,s=t,d&&(Array.isArray(i)||"function"==typeof i||void 0!==i.type||(i.type=Reflect.getMetadata("design:type",o,s))),a(function(e,t){(e.props||(e.props={}))[t]=n})(e,t)}}var n={v1:{ddoKeyCandidateSignIn:"candidateLogin",ddoKeyCandidateRegistration:"candidateRegister",ddoKeyValidateJwtToken:"validateJwtToken",ddoKeyMergedProfile:"mergedProfileV2",ddoKeyLogout:"jwtLogout",ddoKeyEagerLoad:"eagerLoadFyfSession",ddoKeyResetPassword:"candidateResetPassword",ddoKeySendResetPasswordLink:"candidateResetPasswordLink",ddoKeyIsValidToken:"validateOtp",ddoKeyGetPiiConsentConfig:"getPiiConsentConfig",ddoKeySendVerificationEmail:"sendVerificationEmail",ddoKeyCandidateEmailMagicLink:"oneTimeLoginLink",ddoKeyRemoveValidationDataFromSession:"removeValidationDataFromSession"}},l=(c.prototype.makeDDORequest=function(t,e){return r.FetchService.fetchDdo(t,e).then(function(e){return e&&e[t]})},c.prototype.makeDDOGetRequest=function(e){return r.FetchService.fetchGetRequest(e).then(function(e){return e})},c);function c(){}var p,w,C,P=function(){},S=function(){this.email={error:!1,code:"",srHidden:!1},this.password={error:!1,code:"",srHidden:!1},this.server={error:!1,code:""}},k="ddoKeyCandidateEmailMagicLink",D=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/,T="signIn",L="signUp",x="resetPassword",M="signIn",V="EMAIL_PASSWORD",O="forgotPassword",F="candidateProfileUpdated",R="ph:candidateLoggedinEvent",I="getUserProfileData",_="fyf_container",q="ph:bot:removeProfile",A="ph:site:removeProfile",U="apply",H="ph:hash:triggerCandidatePopup",j=27,K=9,B=13,N={upperCase:{regex:/(.*[A-Z].*)/,literal:"",hasError:!1},lowerCase:{regex:/(.*[a-z].*)/,literal:"",hasError:!1},numeric:{regex:/(.*\d.*)/,literal:"",hasError:!1},passwordLength:{regex:/(.{8,})/,literal:"",hasError:!1}},W=[{key:/&lt;/g,value:"<"},{key:/&gt;/g,value:">"},{key:/&amp;/g,value:"&"},{key:/&copy;/g,value:"©"},{key:/&reg;/g,value:"®"},{key:/&ldquo;/g,value:"“"},{key:/&rdquo;/g,value:"”"},{key:/&lsquo;/g,value:"‘"},{key:/&rsquo;/g,value:"’"},{key:/&#39;/g,value:"'"},{key:/&quot;/g,value:'"'},{key:/&apos;/g,value:"'"}],$="fyfSignInHeading",J="fyfSignUpHeading",G="applySignInHeading",Y="applySignUpHeading",z="savedJobsSignUpHeading",Z="savedJobsSignInHeading",Q="loginEmail",X="loginPassword",ee="pcs-candidate-login-v1";function te(){this.constructor=w}function ie(){var e=null!==p&&p.apply(this,arguments)||this;return e.flowType="",e.elementTag=ee,e.bindableModel=new P,e.commonService=r.CommonService,e.localStorage=r.LocalStorage,e.phenomAppManager=r.PhenomAppManager,e.translationFilter=r.TranslationFilter,e.candidateLoginService=new l,e.initialFlowType="",e.isPasswordVisible=!1,e.staySignIn=!0,e.profileDetails={profile:{}},e.isLoggedIn=!1,e.isDialogOpen=!1,e.signInModel={email:"",password:""},e.hasErrors=!1,e.errors=new S,e.step=M,e.isValidEmail=!1,e.isValidPassword=!1,e.isDropdownOpen=!1,e.socialProvider="",e.invalidCredentials=!1,e.resendEmail=!1,e.resetPasswordModel={rpToken:"",newPassword:""},e.pwdRegexMap=N,e.isHeadingDisabled=!1,e.cvUploaded=!1,e.tokenInvalid=!1,e.anonymousEmail="",e.showPasswordSrOnly=!1,e.passwordErrorSrOnly=!1,e.isFirstTimeUser=!0,e.userState="",e.isProfileDataAvailable=!1,e.widgetContent=void 0,e.signInHeading="",e.signUpHeading="",e.isEventRaisedForTriggerHashPopup=!1,e.ignoreMulTriggerHashPopup=!1,e.signUpSuccessSr=!1,e.signInSuccessSr=!1,e.privacyDataConsent=!1,e.privacyConsentError=!1,e.privacyConsentReqFlag=!1,e.piiConsentData={},e.piiConsentError=!1,e.piiConsentContext={},e.showConsentsForm=!1,e.submitData=!1,e.masterLiteralData={},e.isDisabled=!1,e.consentPrefill=!0,e.socialLoginContext={},e.preferredName=!1,e.subscriptions=[],e.isEmailValidationEnabled=!1,e.isVerifiedUser=!1,e.isResendFailed=!1,e.isShowValidationSuccessPopup=!1,e.isShowValidationFailurePopup=!1,e.isShowEmailValidationPopup=!1,e.privacyConsentPreCheck=!1,e.tokenExpiryTimeInMinutes=240,e.tokenExpiryTimeText="",e.isEmailValidationStatus=!1,e.isAccountDeletionStatus=!1,e.isCsrfGetLogoutFlowEnabled=!1,e.isEmailResend=!1,e.isResendBtnEnable=!0,e.resendEmailTimeOut=3e4,e.isDataFetch=!1,e.oneTimeLoginLink=!1,e.deviceType="",e.emailSendTried=!1,e.isMagicEmailLinkSent=!1,e.isShowOneTimeLoginPopup=!1,e.maskedEmail="",e.signUpStep=V,e.isEventRaisedFromApplyThankYouPage=!1,e}return{component:(p=r.BaseComponent,i(w=ie,C=p),w.prototype=null===C?Object.create(C):(te.prototype=C.prototype,new te),ie.prototype.widgetViewLoaded=function(){var o=this;this.element=this.$el,this.getPiiConsentData(),this.getMasterLiteralData(),this.userState=this.phenomAppManager.getSegmentedUserState&&this.phenomAppManager.getSegmentedUserState(),this.isPrivacyDataConsentCheckBoxRequired(),this.isCsrfGetLogoutFlowEnabled=this.commonService.getSiteSettings("isCsrfGetLogoutFlowEnabled"),0==this.commonService.getSiteSettings("consentPrefill")&&(this.consentPrefill=!1),this.preferredName=this.commonService.getSiteSettings("preferredName"),this.oneTimeLoginLink=this.commonService.getSiteSettings("oneTimeLoginLink"),this.oneTimeLoginLink&&(this.signUpStep="LOGIN_LINK");var i=window.location.hash;r.EventBus.$on(H,function(e){if(o.deviceType=o.phenomAppManager.getDeviceType(),o.widgetContext&&"header"==o.widgetContext.context){if(o.isDialogOpen=!1,"mobile"===o.deviceType){var t=document.querySelector('[data-ph-at-id="mobile-hamburger-icon"]');t&&t.click()}o.element.childElementCount||(o.ignoreMulTriggerHashPopup=!0),setTimeout(function(){o.isEventRaisedForTriggerHashPopup&&!o.isLoggedIn&&("#profilelogin"===i?o.handleDialogModal(T):"#createprofile"===i&&o.handleDialogModal(L))},150)}}),this.fetchValidateJwtToken().then(function(){o.getContextBasedHeading(),o.getStateBasedHeading(),o.widgetContext=o.widgetContext||{};var e=o.widgetContext.context;o.isLoggedIn||"header"!==e||o.isEventRaisedForTriggerHashPopup||o.ignoreMulTriggerHashPopup||(o.isEventRaisedForTriggerHashPopup=!0,r.EventBus.$emit(H,{}));var t=o.phenomAppManager.getSessionParams("validationStatus"),i=o.phenomAppManager.getSessionParams("accountDeletionStatus");o.isEmailValidationStatus=!!t,o.isAccountDeletionStatus=!!i,t&&"200"===t||i&&"200"===i?o.isShowValidationSuccessPopup=!0:(t&&("401"===t||"400"===t||"500"===t)||i&&("401"===i||"400"===i||"500"===i))&&(o.isShowValidationFailurePopup=!0),o.openEmailValidationStatusPopup(),(o.isShowValidationSuccessPopup||o.isShowValidationFailurePopup)&&o.candidateLoginService.makeDDORequest(n.v1.ddoKeyRemoveValidationDataFromSession,{}).then(function(e){}),o.isDataFetch=!0}),this.subscribeEvents(),this.flowType=this.flowType||L,this.initialFlowType=this.flowType,this.localStorage.getItem("_li")&&(this.isFirstTimeUser=!1),document.addEventListener("mouseup",this.handleDropdownOutsideScope,!0),document.addEventListener("keyup",this.handleDropdownOutsideScope,!0),this.initialFlowType==x&&this.checkValidToken(),(this.commonService.getSiteSettings("navItems")||{}).candidateHome||this.hideContainer(),this.updateTokenExpiry(),document.addEventListener("openCreateProfilePopup",function(){setTimeout(function(){o.handleDialogModal("signUp"),o.isEventRaisedFromApplyThankYouPage=!0},100)})},ie.prototype.openEmailValidationStatusPopup=function(){var s=this;(this.isShowValidationSuccessPopup||this.isShowValidationFailurePopup)&&setTimeout(function(){var e=s.element.querySelector(s.isLoggedIn?".ph-a11y-after-close-focus-elem":s.isFirstTimeUser?".create-account-link":".sign-in-link"),t=s.element.querySelector(s.isShowValidationSuccessPopup?".email-val-success .btn":".email-val-failure .btn"),i=s.element.querySelector(".popup-modal-backdrop");i&&i.classList.add("active");var o=s.element.querySelector(s.isShowValidationSuccessPopup?".ph-ally-email-validation-success":".ph-ally-email-validation-failure");document.addEventListener("keyup",s.handleValidationStatusEscape),document.addEventListener("click",s.handleValidationStatusEscape),o&&r.DialogManager.openDialog(o,t,e,null,null,!0)},250)},ie.prototype.updateTokenExpiry=function(){this.tokenExpiryTimeInMinutes=parseInt(this.commonService.getSiteSettings("emailValidationTokenExpiry"))||this.tokenExpiryTimeInMinutes;var e=Math.floor(this.tokenExpiryTimeInMinutes/60),t=this.tokenExpiryTimeInMinutes%60;e&&(this.tokenExpiryTimeText+=e+(1<e?" hours ":" hour ")),t&&(this.tokenExpiryTimeText+=t+(1<t?" minutes":" minute")),this.tokenExpiryTimeText=this.tokenExpiryTimeText.trim()+"."},ie.prototype.getMasterLiteralData=function(){this.masterLiteralData=window.phApp&&window.phApp.translations&&window.phApp.translations.masterData,this.masterLiteralData&&(this.masterLiteralData=this.replaceSpeChar(this.masterLiteralData))},ie.prototype.replaceSpeChar=function(t){var i=!1,o=t;if(t&&"object"==typeof t&&Object.keys(t).length)try{t=JSON.stringify(t),i=!0}catch(e){t=o,i=!1}if(t&&"string"==typeof t&&W.forEach(function(e){t=t.replace(e.key,e.value)}),i&&t)try{t=JSON.parse(t)}catch(e){t=o}return t},ie.prototype.getPiiConsentData=function(){var i=this,o=n.v1.ddoKeyGetPiiConsentConfig;this.candidateLoginService.makeDDORequest(o,{}).then(function(e){if(e&&e.status&&"success"==e.status&&e.data)window.phApp&&window.phApp.ddo&&(window.phApp.ddo[o]=e),i.piiConsentData=e.data,i.handleConsentData();else{var t=i.commonService.getSiteSettings("piiConsentConfig");t&&(i.piiConsentData=JSON.parse(JSON.stringify(t)),i.handleConsentData())}})},ie.prototype.handleConsentData=function(){this.piiConsentData&&this.piiConsentData.length&&(this.piiConsentContext={},this.piiConsentContext.consentData=this.piiConsentData,this.signUpStep==V?this.piiConsentContext.submit=this.signUp.bind(this):this.piiConsentContext.submit=this.sendMagicLink.bind(this),this.piiConsentContext.submitFocus=this.element.querySelector(".submit"),this.socialLoginContext.consentData=this.piiConsentData,this.socialLoginContext.checkConsentError=this.hasPiiErrors.bind(this),this.socialLoginContext.handleError=this.socialLoginError.bind(this),(this.socialLoginContext.widgetRef=this).$forceUpdate())},ie.prototype.socialLoginError=function(){this.piiConsentError&&(this.piiConsentContext&&this.piiConsentContext.triggerPopup&&this.piiConsentContext.triggerPopup(!0),this.trackWidgetClick("pii-popup-trigger",{}),this.consentsForm(),this.$forceUpdate())},ie.prototype.created=function(){},ie.prototype.contentModelLoaded=function(){this.content&&this.contentId&&(this.widgetContent=this.content[this.contentId])},ie.prototype.fetch=function(){},ie.prototype.widgetContextChanged=function(e,t){e&&e.triggerPopup&&(this.isHeadingDisabled=!0,this.handleDialogModal(this.flowType,e.closeSelector)),e&&e.profile&&e.profile.email&&(this.anonymousEmail=e.profile.email)&&(this.signInModel.email=this.anonymousEmail),e&&e.resumeUploaded&&(this.cvUploaded=!0),this.getContextBasedHeading()},ie.prototype.getContextBasedHeading=function(){if(this.widgetContext&&this.widgetContext.context&&this.widgetContext.context.length&&this.widgetContent)switch(this.widgetContext.context){case"fyf":case _:this.widgetContent[$]&&(this.signInHeading=this.widgetContent[$]),this.widgetContent[J]&&(this.signUpHeading=this.widgetContent[J]);break;case U:this.widgetContent[G]&&(this.signInHeading=this.widgetContent[G]),this.widgetContent[Y]&&(this.signUpHeading=this.widgetContent[Y])}},ie.prototype.getStateBasedHeading=function(){(!this.widgetContext||this.widgetContext&&this.widgetContext.context!=U)&&("visitor"==this.userState&&!this.isProfileDataAvailable&&this.widgetContent?(this.widgetContent[Z]&&(this.signInHeading=this.widgetContent[Z]),this.widgetContent[z]&&(this.signUpHeading=this.widgetContent[z])):this.isProfileDataAvailable&&this.widgetContent&&(this.widgetContent[$]&&(this.signInHeading=this.widgetContent[$]),this.widgetContent[J]&&(this.signUpHeading=this.widgetContent[J])))},ie.prototype.setValueInLocalStorage=function(){this.localStorage.setItem("_li","1")},ie.prototype.isPrivacyDataConsentCheckBoxRequired=function(){this.privacyConsentReqFlag=this.commonService.getSiteSettings("privacyDataConsentCheckBox"),this.commonService.getSiteSettings("privacyDataConsentPreCheck")&&(this.privacyDataConsent=!0,this.privacyConsentPreCheck=!0)},ie.prototype.isPrivacyConsentChecked=function(){this.privacyDataConsent&&(this.privacyConsentError=!1)},ie.prototype.hasPiiErrors=function(){var t=this;return this.piiConsentError=!1,this.piiConsentData&&this.piiConsentData.length&&this.piiConsentData.forEach(function(e){e.optional||e.isChecked||(t.piiConsentError=!0)}),this.$forceUpdate(),this.piiConsentError},ie.prototype.isButtonDisabled=function(){var t=this;this.isDisabled=!1,this.piiConsentData&&this.piiConsentData.length&&this.piiConsentData.forEach(function(e){e.optional||e.isChecked||(t.isDisabled=!0)}),this.isDisabled||(this.piiConsentError=!1)},ie.prototype.signIn=function(){var i=this,e=this.validateEmail(!0),t=this.validatePassword(this.signInModel.password,!0,e);this.hasErrors=e||t,this.hideError();var o=this.widgetContext&&this.widgetContext.context||"";if(this.hasErrors)this.focusToErrorField();else{var s={email:this.signInModel.email,password:this.signInModel.password,validationContext:""!=o?o:"candidateLogin"};this.staySignIn||(s.unTrustedDevice=!0),o===U&&this.trackWidgetClick("ch_signin_trigger_apply_ty",{}),this.candidateLoginService.makeDDORequest(n.v1.ddoKeyCandidateSignIn,s).then(function(t){if(t&&"success"==t.status&&200==t.code){setTimeout(function(){i.signInSuccessSr=!0,setTimeout(function(){i.signInSuccessSr=!1},2e3)},1e3),i.setEagerLoadFlowType();var e={context:o||i.phenomAppManager.getPageName()};i.isEmailValidationEnabled=t.data&&t.data.isEmailValidationEnabled,i.trackWidgetClick("profile_signIn_click",e),i.raiseCustomEvent("ph:ex:jobCartUpdatedCount",{}),i.initialFlowType==x?window.location.href=i.phenomAppManager.getBaseUrl():(i.fetchValidateJwtToken(!0).then(function(e){i.closePopup(),"fyf_container"!=i.widgetContext.context&&"fyf"!=i.widgetContext.context&&i.isEmailValidationEnabled&&!i.isVerifiedUser&&(i.isShowEmailValidationPopup=!0,t.data.sendVerificationEmail&&t.data.sendVerificationEmail&&"failure"==t.data.sendVerificationEmail.status&&400==t.data.sendVerificationEmail.data.status&&(i.isResendFailed=!0),i.openEmailValidationPopup())}).catch(function(){i.closePopup()}),i.resetErrorFields()),i.setValueInLocalStorage(),o===U&&i.trackWidgetClick("ch_signin_apply_ty",{})}else t&&"failure"==t.status&&405==t.code&&t.data?(i.isValidEmail=!1,i.errors.email.error=!0,i.errors.email.code="E103",i.errors.email.socialProvider=t.data.socialProvider,i.focusToField(Q)):t&&"failure"==t.status&&404==t.code?(i.isValidPassword=!1,i.errors.password.error=!0,i.errors.password.code="E103",i.focusToField(X)):t&&"failure"==t.status&&401==t.code?(i.isValidEmail=!1,i.errors.email.error=!0,i.errors.email.code="E105",i.focusToField(Q)):i.showError("E500")})}},ie.prototype.maskEmail=function(e){var t=e.split("@"),i=t[0],o=t[1];return i.charAt(0)+"*".repeat(i.length-1)+"@"+o},ie.prototype.sendMagicLink=function(){var t=this;this.privacyConsentError=!1;var e=this.validateEmail(!0);this.hasErrors=e,this.hideError();var i=this.widgetContext&&this.widgetContext.context||"";if(this.hasErrors)return this.privacyConsentReqFlag&&!this.privacyDataConsent?void(this.privacyConsentError=!0):void this.focusToErrorField();if(this.hasPiiErrors(),this.piiConsentError&&!this.hasErrors)return this.piiConsentContext&&this.piiConsentContext.triggerPopup&&this.piiConsentContext.triggerPopup(!0),this.trackWidgetClick("pii-popup-trigger",{}),void this.consentsForm(!0);if(this.hasErrors){if(this.privacyConsentReqFlag&&!this.privacyDataConsent)return void(this.privacyConsentError=!0);this.focusToErrorField()}else{if(this.closeConsentsForm(!0),this.submitData=!1,this.privacyConsentReqFlag&&!this.privacyDataConsent)return void(this.privacyConsentError=!0);this.maskedEmail=this.maskEmail(this.signInModel.email);var o={email:this.signInModel.email,isSystemDefaultPage:!0,metaData:{},validationContext:""!=i?i:"candidateLogin"};this.staySignIn||(o.unTrustedDevice=!0),i===U&&this.trackWidgetClick("ch_signup_trigger_apply_ty",{}),this.piiConsentData&&this.piiConsentData.length&&this.piiConsentData.forEach(function(e){e.type&&(o.metaData[e.type]=!!e.isChecked)}),this.candidateLoginService.makeDDORequest(n.v1[k],o).then(function(e){e&&"success"==e.status&&200==e.code?(t.emailSendTried=!0,t.isMagicEmailLinkSent=!0):(t.emailSendTried=!0,t.isMagicEmailLinkSent=!1)})}},ie.prototype.reSendMagicLink=function(){var t=this,e=this.widgetContext&&this.widgetContext.context||"",i={email:this.signInModel.email,isSystemDefaultPage:!0,metaData:{},validationContext:""!=e?e:"candidateLogin"};this.piiConsentData&&this.piiConsentData.length&&this.piiConsentData.forEach(function(e){e.type&&(i.metaData[e.type]=!!e.isChecked)}),this.candidateLoginService.makeDDORequest(n.v1[k],i).then(function(e){e&&"success"==e.status&&200==e.code?(t.emailSendTried=!0,t.isMagicEmailLinkSent=!0):(t.emailSendTried=!0,t.isMagicEmailLinkSent=!1)})},ie.prototype.fetchValidateJwtToken=function(t){var i=this;return this.unhideLoader(),this.candidateLoginService.makeDDORequest(n.v1.ddoKeyValidateJwtToken,{}).then(function(e){if(e&&e.data){if(i.isLoggedIn=e.data.isValidToken&&!e.data.isAnonymous,e.data.isSocialLogin&&i.setValueInLocalStorage(),i.isLoggedIn)return i.isProfileDataAvailable=!0,i.fetchProfileData(t||!1,!1);if(e.data.isAnonymous)return i.isProfileDataAvailable=!0,i.fetchProfileData(t||!1,!0);i.hideLoader()}else i.hideLoader();return new Promise(function(e,t){e({})})},function(e){i.hideLoader()})},ie.prototype.fetchProfileData=function(i,o){var s=this;return this.candidateLoginService.makeDDORequest(n.v1.ddoKeyMergedProfile,{sendEmailValidationStatus:!0,isEagerLoad:!0}).then(function(t){if(t&&Object.keys(t).length&&"success"==t.status){if(s.isEmailValidationEnabled=t.isEmailValidationEnabled,t.hasOwnProperty("verifiedEmails")&&t.verifiedEmails&&t.verifiedEmails.includes(t.email)&&(s.isVerifiedUser=!0),o?(s.anonymousEmail=t.email,s.anonymousEmail&&(s.signInModel.email=s.anonymousEmail)):s.profileDetails.profile=t||{},i){s.publishSignInEvents(t);var e={context:"candidateProfile"};s.widgetContext=s.widgetContext||{context:"header"},e.widgetContext=s.widgetContext.context,s.dispatchEvent(I,e)}s.piiConsentData&&s.piiConsentData.length&&s.consentPrefill&&s.piiConsentData.forEach(function(e){t&&t[e.type]&&(e.isChecked=!0)})}else s.isLoggedIn=!1;s.hideLoader()},function(e){s.hideLoader()})},ie.prototype.publishSignInEvents=function(e){this.dispatchEvent(R,e),this.dispatchEvent("jobCartUpdatedCount",{})},ie.prototype.checkEmailValidation=function(){this.isValidEmail=D.test(this.signInModel.email)},ie.prototype.checkPasswordValidation=function(e){var t=document.querySelector('[id="createPassword"]');t&&t.removeAttribute("aria-describedby"),e=e||this.signInModel.password,this.isValidPassword=b.test(e),this.errors.password.error?(t&&t.setAttribute("aria-describedby","errorCreatePasswordSrOnly"),this.passwordErrorSrOnly=!0):t&&t.setAttribute("aria-describedby","errorCreatePassword")},ie.prototype.validateEmail=function(e){var t=this;this.errors.email.error=!1,this.errors.email.srHidden=!!e;var i=!1;return i=this.signInModel.email?D.test(this.signInModel.email)?(this.errors.email.code=void 0,!1):(this.errors.email.code="E102",!0):(this.errors.email.code="E101",!0),setTimeout(function(){t.errors.email.error=i},0),i},ie.prototype.validatePassword=function(t,e,i){var o=this;t=t||this.signInModel.password,this.errors.password.error=!1,this.errors.password.srHidden=!!i;var s=!1;return s=e?t.length?(this.errors.password.code=void 0,!1):(this.errors.password.code="E101",!0):b.test(t)?(this.errors.password.code=void 0,Object.keys(this.pwdRegexMap).forEach(function(e){o.pwdRegexMap[e].hasError=!1}),!1):(Object.keys(this.pwdRegexMap).forEach(function(e){o.pwdRegexMap[e].regex.test(t)?o.pwdRegexMap[e].hasError=!1:o.pwdRegexMap[e].hasError=!0}),!0),setTimeout(function(){o.errors.password.error=s},0),s},ie.prototype.validateNewPassword=function(){return this.validatePassword(this.resetPasswordModel.newPassword)},ie.prototype.forgotPassword=function(){var e=this;this.resetErrorFields(),this.unhideLoader(),this.hideLoader(),this.step=O,setTimeout(function(){e.focusToField(Q)},100)},ie.prototype.sendPswdResetLink=function(t){var i=this;if(this.hasErrors=this.validateEmail(!0),this.hasErrors)this.focusToField(Q);else{var e={email:this.signInModel.email};this.candidateLoginService.makeDDORequest(n.v1.ddoKeySendResetPasswordLink,e).then(function(e){e&&("success"==e.status||200==e.status||"failure"==e.status&&401==e.code)?(i.trackWidgetClick("reset_password_link_click",{}),i.resetErrorFields(),i.unhideLoader(),i.hideLoader(),i.step="resetPasswordLink",t?(i.isEmailResend=!0,setTimeout(function(){i.focusToField(".resend-success-text"),i.isResendBtnEnable=!1},20),setTimeout(function(){i.isEmailResend=!1,i.isResendBtnEnable=!0},i.resendEmailTimeOut)):setTimeout(function(){i.focusToField(".ph-a11y-popup-start-focus ")},100),i.tokenInvalid=!1):i.showError("E500")})}},ie.prototype.resendPswrdResetLink=function(){this.resendEmail=!0,this.sendPswdResetLink(!0)},ie.prototype.changeFlowType=function(e,t){var i=this;this.resetErrorFields(),this.flowType=e,this.step=t||M,this.signInModel.password="",this.resetPasswordModel.newPassword="",this.isPasswordVisible=!1,this.isValidPassword=!1,this.staySignIn=!0,this.privacyConsentError=!1,Object.keys(this.pwdRegexMap).forEach(function(e){i.pwdRegexMap[e].hasError=!1}),setTimeout(function(){i.focusToField(Q)},100)},ie.prototype.handleDialogModal=function(e,t){this.isDialogOpen=!0,t?(this.isDialogOpen=!0,this.addModalPopup(Q,t)):(this.flowType=e,this.initialFlowType=e,this.isDialogOpen=!0,e==T?this.addModalPopup(Q,".sign-in-link"):e==L&&(this.addModalPopup(Q,".create-account-link"),this.focusToField(Q)))},ie.prototype.addModalPopup=function(s,n){var a=this;setTimeout(function(){var e;e=a.isEventRaisedFromApplyThankYouPage?document.querySelector(".go-to-profile-btn"):"string"==typeof n?a.element.querySelector(n):n;var t=a.$refs[s],i=a.element.querySelector(".popup-modal-backdrop");i&&i.classList.add("active");var o=a.element.querySelector(".ph-a11y-modal-area");a.element.addEventListener("keyup",a.handleEscape),a.element.addEventListener("click",a.handleEscape),o&&r.DialogManager.openDialog(o,t,e)},0),setTimeout(function(){var e=a.$refs[Q];e&&a.anonymousEmail&&a.anonymousEmail.length&&(e.value=a.anonymousEmail)},50)},ie.prototype.handleEscape=function(e){var t=this.element.querySelector(".ph-a11y-modal-area");"Escape"!=e.key&&27!==e.keyCode&&27!==e.which&&e.target!=t||this.closePopup()},ie.prototype.closePopup=function(){this.isDialogOpen=!1,r.DialogManager.close(),this.signInModel.password="",this.signInModel.email="",this.resetPasswordModel.newPassword="",this.step=M,this.flowType=this.initialFlowType,this.isValidEmail=!1,this.isValidPassword=!1,this.resendEmail=!1,this.isPasswordVisible=!1,this.cvUploaded=!1,this.privacyConsentError=!1,this.piiConsentError=!1,this.showConsentsForm=!1,this.emailSendTried=!1,this.resetErrorFields(),this.widgetContext&&this.widgetContext.context==_&&this.widgetContext.widgetRef&&this.widgetContext.widgetRef.closePopup&&this.widgetContext.widgetRef.closePopup(),this.element.removeEventListener("keyup",this.handleEscape),this.element.removeEventListener("click",this.handleEscape),this.isEventRaisedFromApplyThankYouPage&&"mobile"==this.deviceType&&this.toggleMenu(),this.isEventRaisedFromApplyThankYouPage=!1},ie.prototype.toggleDropDown=function(){this.isDropdownOpen=!this.isDropdownOpen},ie.prototype.consentsForm=function(e){var t=this;this.piiConsentData&&3<=this.piiConsentData.length&&(this.unhideLoader(),this.hideLoader(),this.isDialogOpen=!1,this.isDialogOpen=!0,this.showConsentsForm=!0,this.submitData=!!e,this.isButtonDisabled(),setTimeout(function(){t.focusToField(".back-btn")},50))},ie.prototype.closeConsentsForm=function(e){var t=this;this.showConsentsForm=!1,e?this.trackWidgetClick("pii-consent-submit",{}):this.trackWidgetClick("pii-consent-done",{}),setTimeout(function(){t.focusToField(".consents-link")},100)},ie.prototype.signUp=function(){var i=this;this.privacyConsentError=!1;var e=this.validateEmail(!0),t=this.validatePassword(this.signInModel.password,!1,e);this.hasErrors=e||t,this.hideError();var o=this.widgetContext&&this.widgetContext.context||"";if(this.hasErrors)return this.privacyConsentReqFlag&&!this.privacyDataConsent?void(this.privacyConsentError=!0):void this.focusToErrorField();if(this.hasPiiErrors(),this.piiConsentError&&!this.hasErrors)return this.piiConsentContext&&this.piiConsentContext.triggerPopup&&this.piiConsentContext.triggerPopup(!0),this.trackWidgetClick("pii-popup-trigger",{}),void this.consentsForm(!0);if(this.hasErrors){if(this.privacyConsentReqFlag&&!this.privacyDataConsent)return void(this.privacyConsentError=!0);this.focusToErrorField()}else{if(this.closeConsentsForm(!0),this.submitData=!1,this.privacyConsentReqFlag&&!this.privacyDataConsent)return void(this.privacyConsentError=!0);var s={email:this.signInModel.email,password:this.signInModel.password,validationContext:""!=o?o:"candidateLogin"};this.staySignIn||(s.unTrustedDevice=!0),o===U&&this.trackWidgetClick("ch_signup_trigger_apply_ty",{}),s.profile=s.profile||{},this.piiConsentData&&this.piiConsentData.length&&this.piiConsentData.forEach(function(e){e.type&&(s.profile[e.type]=!!e.isChecked)}),this.candidateLoginService.makeDDORequest(n.v1.ddoKeyCandidateRegistration,s).then(function(e){if(e&&"success"==e.status&&200==e.code){setTimeout(function(){i.signUpSuccessSr=!0,setTimeout(function(){i.signUpSuccessSr=!1},2e3)},1e3),i.setEagerLoadFlowType();var t={context:o||i.phenomAppManager.getPageName()};i.trackWidgetClick("profile_signUp_click",t),i.isEmailValidationEnabled=e.data&&e.data.isEmailValidationEnabled,i.fetchValidateJwtToken(!0).then(function(e){i.closePopup(),"fyf_container"!=i.widgetContext.context&&i.isEmailValidationEnabled&&!i.isVerifiedUser&&(i.isShowEmailValidationPopup=!0,i.openEmailValidationPopup())}).catch(function(){i.closePopup()}),i.resetErrorFields(),i.setValueInLocalStorage(),o===U&&i.trackWidgetClick("ch_signup_apply_ty",{})}else e&&"failure"==e.status&&405==e.code&&e.data?(i.isValidEmail=!1,i.errors.email.error=!0,i.errors.email.code="E103",i.errors.email.socialProvider=e.data.socialProvider,i.focusToField(Q)):e&&"failure"==e.status&&402==e.code?(i.isValidEmail=!1,i.errors.email.error=!0,i.errors.email.code="E104",i.focusToField(Q)):i.showError("E500")})}},ie.prototype.handleDropdownOutsideScope=function(e){var t=this.handleOutsideScopeEvents(e,"post-sign-in-action-area");null!=t&&(this.isDropdownOpen=t)},ie.prototype.handleOutsideScopeEvents=function(e,t){var i,o,s=e.target,n=!1;if(e.keyCode===B||e.keyCode==K||null==e.keyCode)for(;s;)if(o=(s=s.parentElement)&&s.classList)if(null!=s&&o.contains(t)){if(o.contains(t)){n=!1;break}}else n=!0;else s||(n=!0);return!n&&e.keyCode!=j||(i=!1),i},ie.prototype.destroyed=function(){var t=this;this.subscriptions.forEach(function(e){t.unsubscribeEvent(e)}),document.removeEventListener("mouseup",this.handleDropdownOutsideScope,!0),document.removeEventListener("keyup",this.handleDropdownOutsideScope,!0),document.removeEventListener(A,this.resetProfileData),document.removeEventListener(q,this.resetProfileData),document.removeEventListener(F,this.updateProfileData),document.removeEventListener(R,this.updateProfileData),document.removeEventListener(I,this.getProfileData),this.changeFlowType(this.initialFlowType),r.EventBus.$off(H)},ie.prototype.resetErrorFields=function(){var t=this;setTimeout(function(){t.errors=new S,t.socialProvider="",Object.keys(t.pwdRegexMap).length&&Object.keys(t.pwdRegexMap).forEach(function(e){t.pwdRegexMap[e]&&(t.pwdRegexMap[e].hasError=!1)})},0)},ie.prototype.showError=function(e){this.errors.server.error=!0,this.errors.server.code=e},ie.prototype.hideError=function(){this.errors.server.error=!1,this.errors.server.code=""},ie.prototype.updateProfileData=function(e){var t=e&&e.detail?e.detail:e;this.profileDetails.profile=t||{},this.isLoggedIn=!0,this.isEmailValidationEnabled=t.isEmailValidationEnabled,t.hasOwnProperty("verifiedEmails")&&t.verifiedEmails&&t.verifiedEmails.includes(t.email)&&(this.isVerifiedUser=!0),this.piiConsentData&&this.piiConsentData.length&&this.consentPrefill&&this.piiConsentData.forEach(function(e){t&&t[e.type]&&(e.isChecked=!0)})},ie.prototype.getProfileData=function(e){"candidateProfile"!=(e&&e.detail?e.detail:e).context&&this.fetchProfileData(!1,!0)},ie.prototype.subscribeEvents=function(){document.addEventListener(F,this.updateProfileData),this.subscriptions.push(F),this.subscribeEvent(F,this.updateProfileData.bind(this)),document.addEventListener(R,this.updateProfileData),this.subscriptions.push(R),this.subscribeEvent(R,this.updateProfileData.bind(this)),document.addEventListener(I,this.getProfileData),this.subscriptions.push(I),this.subscribeEvent(I,this.getProfileData.bind(this)),document.addEventListener(A,this.resetProfileData),this.subscriptions.push(A),this.subscribeEvent(A,this.resetProfileData.bind(this)),document.addEventListener(q,this.resetProfileData),this.subscriptions.push(q),this.subscribeEvent(q,this.resetProfileData.bind(this))},ie.prototype.resetProfileData=function(){this.anonymousEmail="",this.signInModel.email="",this.profileDetails.profile={},this.piiConsentData&&this.piiConsentData.length&&this.consentPrefill&&this.piiConsentData.forEach(function(e){e.isChecked=!1})},ie.prototype.checkValidToken=function(){var t=this;this.resetPasswordModel.rpToken=this.commonService.getQueryParam("rp");var e={rpToken:this.resetPasswordModel.rpToken};this.candidateLoginService.makeDDORequest(n.v1.ddoKeyIsValidToken,e).then(function(e){e&&"success"==e.status?t.tokenInvalid=!1:e&&"failure"==e.status&&403==e.code&&(t.tokenInvalid=!0,t.changeFlowType(T,O))},function(e){})},ie.prototype.resetPassword=function(){var t=this;if(this.hasErrors=!this.tokenInvalid&&this.validateNewPassword(),this.hideError(),this.hasErrors||this.tokenInvalid)this.focusToField(X);else{this.resetPasswordModel.rpToken=this.resetPasswordModel.rpToken||this.commonService.getQueryParam("rp");var e={rpToken:this.resetPasswordModel.rpToken,newPassword:this.resetPasswordModel.newPassword};this.candidateLoginService.makeDDORequest(n.v1.ddoKeyResetPassword,e).then(function(e){e&&"success"==e.status?(t.trackWidgetClick("reset_password_click",{}),t.resetErrorFields(),t.resetPasswordModel.password="",t.changeFlowType(T)):e&&"failure"==e.status&&403==e.code?(t.resetPasswordModel.password="",t.tokenInvalid=!0):t.showError("E500")})}},ie.prototype.setEagerLoadFlowType=function(){this.candidateLoginService.makeDDORequest(n.v1.ddoKeyEagerLoad,{flowType:"candidateProfile"}).then(function(e){})},ie.prototype.showHidePassword=function(){var e,t=this;this.isPasswordVisible=!this.isPasswordVisible,clearTimeout(e),this.showPasswordSrOnly=!0,e=setTimeout(function(){t.showPasswordSrOnly=!1},50)},ie.prototype.focusToField=function(e){var t=this.$refs[e]?this.$refs[e]:this.element.querySelector(e);t&&t.focus()},ie.prototype.focusToErrorField=function(){var t=this;setTimeout(function(){if(t.errors.email.error)t.focusToField(Q);else if(t.errors.password.error){t.focusToField(X);var e=document.querySelector('[id="createPassword"]');e&&e.setAttribute("aria-describedby","errorCreatePasswordSrOnly"),t.focusToField(X)}},0)},ie.prototype.addSronlyText=function(e){if(e){var t=document.createElement("span");t.setAttribute("class","sr-only"),t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true"),document.body.appendChild(t),setTimeout(function(){t.innerText=e,setTimeout(function(){t.remove()},1e3)},200)}},ie.prototype.resendVerificationEmail=function(){var o=this;this.candidateLoginService.makeDDORequest(n.v1.ddoKeySendVerificationEmail,{profile:{},validationContext:"candidateLogin"}).then(function(e){if(e&&e.status&&"success"==e.status){var t=o.element.querySelector(".ph-a11y-candidate-login-email-val-heading");null==t||t.setAttribute("tabindex","-1"),o.focusElement(t,250)}else{o.isResendFailed=!0;var i=o.element.querySelector(".ph-a11y-candidate-login-email-sent-failed");o.focusElement(i,50)}})},ie.prototype.openEmailValidationPopup=function(){var s=this;setTimeout(function(){var e=s.element.querySelector(".ph-a11y-after-close-focus-elem"),t=s.element.querySelector(".email-validation-popup .ph-a11y-popup-start-focus"),i=s.element.querySelector(".popup-modal-backdrop");i&&i.classList.add("active");var o=s.element.querySelector(".ph-a11y-modal-area");s.element.addEventListener("keyup",s.handleValidationEscape),s.element.addEventListener("click",s.handleValidationEscape),r.DialogManager.openDialog(o,t,e)},0)},ie.prototype.closeValidationSuccessPopup=function(){var e=this.element.querySelector(".popup-modal-backdrop");e&&e.classList.remove("active"),r.DialogManager.close(),this.isShowValidationSuccessPopup=!1,document.removeEventListener("keyup",this.handleValidationStatusEscape),document.removeEventListener("click",this.handleValidationStatusEscape)},ie.prototype.closeValidationFailurePopup=function(){var e=this.element.querySelector(".popup-modal-backdrop");e&&e.classList.remove("active"),r.DialogManager.close(),this.isShowValidationFailurePopup=!1,document.removeEventListener("keyup",this.handleValidationStatusEscape),document.removeEventListener("click",this.handleValidationStatusEscape)},ie.prototype.closeEmailValidationPopup=function(){var e=this.element.querySelector(".popup-modal-backdrop");e&&e.classList.remove("active"),r.DialogManager.close(),this.isShowEmailValidationPopup=!1,this.element.removeEventListener("keyup",this.handleValidationEscape),this.element.removeEventListener("click",this.handleValidationEscape)},ie.prototype.handleValidationEscape=function(e){var t=this.element.querySelector(".ph-a11y-modal-area");"Escape"!=e.key&&27!==e.keyCode&&27!==e.which&&e.target!=t||this.isShowEmailValidationPopup&&this.closeEmailValidationPopup()},ie.prototype.handleValidationStatusEscape=function(e){var t=this.element.querySelector(".ph-a11y-modal-area");"Escape"!=e.key&&27!==e.keyCode&&27!==e.which&&e.target!=t||(this.isShowValidationSuccessPopup?this.closeValidationSuccessPopup():this.isShowValidationFailurePopup&&this.closeValidationFailurePopup())},ie.prototype.handleLogoutFlow=function(){var t=this,e=this.phenomAppManager.getBaseUrl()+"logout";this.candidateLoginService.makeDDOGetRequest(e).then(function(e){window.location.assign(t.phenomAppManager.getBaseUrl())})},e([s()],ie.prototype,"flowType",void 0),e([s()],ie.prototype,"widgetContext",void 0),e([s()],ie.prototype,"toggleMenu",void 0),e([function(o,e){void 0===e&&(e={});var t=e.deep,s=void 0!==t&&t,i=e.immediate,n=void 0!==i&&i;return a(function(e,t){"object"!=typeof e.watch&&(e.watch=Object.create(null));var i=e.watch;"object"!=typeof i[o]||Array.isArray(i[o])?void 0===i[o]&&(i[o]=[]):i[o]=[i[o]],i[o].push({handler:t,deep:s,immediate:n})})}("widgetContext")],ie.prototype,"widgetContextChanged",null),ie=e([t({name:ee})],ie))}});
